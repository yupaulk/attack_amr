width = 0.5)
),
link = with(links, list(
source = SourceNr,
target = TargetNr,
value =  Value
))
)
return(list(plot = p, links = links))
}
p <- plot_sankey(metaphlan_PHY_rel_species, source="Kingdom", target="Species", level_filter="Kingdom")
htmlwidgets::saveWidget(p[[1]], file = "plot4_sankey_species.html")
write_csv(psmelt(resfinder_PHY_rel_HWW), file = 'resfinder_PHY_rel_HWW.csv')
write_csv(psmelt(resfinder_PHY_rel_HWW), file = 'resfinder_PHY_rel_HWW.csv')
write_csv(psmelt(MGE_PHY_rel_HWW), file = 'MGE_PHY_rel_HWW.csv')
write_csv(psmelt(MGE_PHY_rel_HWW), file = 'MGE_PHY_rel_HWW.csv')
write_csv(psmelt(metaphlan_PHY_rel_phylum), file = 'metaphlan_PHY_rel_phylum.csv')
write_csv(psmelt(metaphlan_PHY_rel_class), file = 'metaphlan_PHY_rel_class.csv')
write_csv(psmelt(metaphlan_PHY_rel_order), file = 'metaphlan_PHY_rel_order.csv')
write_csv(psmelt(metaphlan_PHY_rel_family), file = 'metaphlan_PHY_rel_family.csv')
write_csv(psmelt(metaphlan_PHY_rel_genus), file = 'metaphlan_PHY_rel_genus.csv')
write_csv(psmelt(metaphlan_PHY_rel_species), file = 'metaphlan_PHY_rel_species.csv')
sessionInfo()
arg_even <- data.frame("evenness" = arg_shannon_div$shannon / log(arg_rich$richness))
rownames(arg_even) <- colnames(resfinder_PHY_rel_HWW@otu_table)
all(rownames(arg_even) == colnames(resfinder_PHY_rel_HWW@otu_table))
arg_even$hospital <- as.factor(resfinder_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
arg_even_eda <- arg_even %>%
group_by(hospital) %>%
summarise(
mean = mean(evenness),
sd = sd(evenness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(evenness ~ hospital, data = arg_even)
# There are sig. differences
# Test multiple pairwise
arg_even_stat.test <- pairwise.wilcox.test(arg_even$evenness, arg_even$hospital,
p.adjust.method = "BH")
arg_even_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("n.s.","n.s.","**"))
# Plot
p <- ggboxplot(arg_even, x = "hospital", y = "evenness", fill = "hospital", palette = c("#CD3857", "#61A6E3", "#CC7722")) +
stat_pvalue_manual(pvalues, size = 6, y.position = 0.85, step.increase = 0.05, label = "p.adj")
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4, aes(fill=hospital)) +
scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Evenness for ARGs Across Hospitals",
subtitle = "Pielou's Evenness by Hospital") +
scale_y_continuous(limits = c(0.65,0.9), breaks = seq(0.65,0.9, by = 0.05))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(arg_even), arg_even$evenness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot5_arg_evenness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
arg_even <- data.frame("evenness" = arg_shannon_div$shannon / log(arg_rich$richness))
rownames(arg_even) <- colnames(resfinder_PHY_rel_HWW@otu_table)
all(rownames(arg_even) == colnames(resfinder_PHY_rel_HWW@otu_table))
arg_even$hospital <- as.factor(resfinder_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
arg_even_eda <- arg_even %>%
group_by(hospital) %>%
summarise(
mean = mean(evenness),
sd = sd(evenness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(evenness ~ hospital, data = arg_even)
# There are no sig. differences
# Plot
p <- ggboxplot(arg_even, x = "hospital", y = "evenness", fill = "hospital", palette = c("#CD3857", "#61A6E3", "#CC7722"))
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4, aes(fill=hospital)) +
scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Evenness for ARGs Across Hospitals",
subtitle = "Pielou's Evenness byo Hospital") +
scale_y_continuous(limits = c(0.65,0.9), breaks = seq(0.65,0.9, by = 0.05))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(arg_even), arg_even$evenness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot5_arg_evenness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggboxplot(mge_rich, x = "hospital", y = "richness", fill = "hospital", palette = c("#CD3857", "#61A6E3", "#CC7722")) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj")
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4, aes(fill = hospital)) +
scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness by Hospital") +
scale_y_continuous(limits = c(400,950), breaks = seq(400,950, by = 50))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(mge_rich), mge_rich$richness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_mge_richness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj")
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
stat_pvalue_manual(pvalues, size = 6, y.position = 800, step.increase = 0.05, label = "p.adj")
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj") +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2)
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj") +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2)
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj") +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2)
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2)
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_mge_richness_bar.tiff",
width = 8, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2)
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj") +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
View(mge_rich_eda)
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, x=hospital, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
stat_pvalue_manual(pvalues, size = 6, y.position = 900, step.increase = 0.05, label = "p.adj")
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
mge_rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_rel_HWW), MARGIN=2))
all(rownames(mge_rich) == colnames(MGE_PHY_rel_HWW@otu_table))
mge_rich$hospital <- as.factor(MGE_PHY_rel_HWW@sam_data$hospital)
# Exploratory data analysis
mge_rich_eda <- mge_rich %>%
group_by(hospital) %>%
summarise(
mean = mean(richness),
sd = sd(richness),
n = n(),
se = sd / sqrt(n),
conf.low = mean - qt(0.975, df = n - 1) * se,
conf.high = mean + qt(0.975, df = n - 1) * se
)
# Test the significance
kruskal.test(richness ~ hospital, data = mge_rich)
# There are no sig. differences
# Test multiple pairwise
mge_rich_stat.test <- pairwise.wilcox.test(mge_rich$richness, mge_rich$hospital,
p.adjust.method = "BH")
mge_rich_stat.test
pvalues <- data.frame(group1 = c("SLMC","UST","CGH"), group2 = c("CGH","SLMC","UST"), p.adj = c("**","*","n.s."))
# Plot
p <- ggplot(mge_rich_eda, x=hospital, aes(x=hospital, y=mean, fill = hospital)) +
geom_bar(stat = "identity", width = 0.7) +
geom_errorbar(aes(ymin = conf.low, ymax = conf.high), width = 0.2) +
stat_pvalue_manual(pvalues, size = 6, y.position = 90, step.increase = 0.05, label = "p.adj")
# Add ID as label to the plot
p1 <- p + scale_fill_manual(values=c("#CD3857", "#61A6E3", "#CC7722")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 20, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness Index by Hospital",
y = "richness")
p1  # Display the plot
