plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for Taxonomic Composition Across Hospitals",
subtitle = "Shannon Diversity Index by Hospital") +
scale_y_continuous(limits = c(2.5,max(shannon_div$shannon)), breaks = seq(2.5,max(shannon_div$shannon), by = 0.5))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(shannon_div), shannon_div$shannon)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot6_shannon.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
simpson_div <- data.frame("simpson" = diversity(otu_table(metaphlan_PHY_counts_genus), index = "simpson", MARGIN = 2))
all(rownames(simpson_div) == colnames(metaphlan_PHY_counts_genus@otu_table))
diversity_observed <- apply(metaphlan_PHY_counts_genus@otu_table > 0, 2, sum)
simpson_div$observed <- diversity_observed
simpson_div$hospital <- metaphlan_PHY_counts_genus@sam_data$hospital
colnames(simpson_div) <- c("simpson", "observed", "hospital")
# Plot
p <- ggplot(simpson_div, aes(x=hospital, y=simpson, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for Taxonomic Composition Across Hospitals",
subtitle = "Simpson Diversity Index by Hospital") +
scale_y_continuous(limits = c(0.9,max(simpson_div$simpson)), breaks = seq(0.9,max(simpson_div$simpson), by = 0.02))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(simpson_div), simpson_div$simpson)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot6_simpson.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
invsimp_div <- data.frame("invsimpson" = diversity(otu_table(metaphlan_PHY_counts_genus), index = "inv", MARGIN = 2))
all(rownames(invsimp_div) == colnames(metaphlan_PHY_counts_genus@otu_table))
diversity_observed <- apply(metaphlan_PHY_counts_genus@otu_table > 0, 2, sum)
invsimp_div$observed <- diversity_observed
invsimp_div$hospital <- metaphlan_PHY_counts_genus@sam_data$hospital
colnames(invsimp_div) <- c("invsimpson", "observed", "hospital")
# Plot
p <- ggplot(invsimp_div, aes(x=hospital, y=invsimpson, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for Taxonomic Composition Across Hospitals",
subtitle = "Inv Simpson Diversity Index by Hospital") +
scale_y_continuous(limits = c(10,max(invsimp_div$invsimpson)), breaks = seq(10,max(invsimp_div$invsimpson), by = 5))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(invsimp_div), invsimp_div$invsimpson)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot6_invsimpson.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
rich <- data.frame("richness" = specnumber(otu_table(metaphlan_PHY_counts_genus), MARGIN=2))
all(rownames(rich) == colnames(metaphlan_PHY_counts_genus@otu_table))
rich$hospital <- metaphlan_PHY_counts_genus@sam_data$hospital
colnames(rich) <- c("richness", "hospital")
# Plot
p <- ggplot(rich, aes(x=hospital, y=richness, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for Taxonomic Composition Across Hospitals",
subtitle = "Richness by Hospital") +
scale_y_continuous(limits = c(200,max(rich$richness)), breaks = seq(200,max(rich$richness), by = 50))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(rich), rich$richness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot6_richness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
even <- data.frame("evenness" = shannon_div$shannon / log(rich$richness))
rownames(even) <- colnames(metaphlan_PHY_counts_genus@otu_table)
all(rownames(even) == colnames(metaphlan_PHY_counts_genus@otu_table))
even$hospital <- metaphlan_PHY_counts_genus@sam_data$hospital
colnames(even) <- c("evenness", "hospital")
# Plot
p <- ggplot(even, aes(x=hospital, y=evenness, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Evenness for Taxonomic Composition Across Hospitals",
subtitle = "Pielou's Evenness by Hospital") +
scale_y_continuous(limits = c(0.5,max(even$evenness)), breaks = seq(0.5,max(even$evenness), by = 0.05))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(even), even$evenness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot6_evenness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
# # Test the significance
# kruskal.test(observed ~ hospital, data = div)
# # There are no sig. differences
#
# # Test multiple pairwise
# stat.test <- pairwise.wilcox.test(div$observed, div$hospital,
#                  p.adjust.method = "BH")
# stat.test
# d <- data.frame("shannon" = diversity(otu_table(MGE_PHY_counts_HWW), index = "shannon", MARGIN = 2))
# div <- cbind(d, data.frame("invsimpson" = diversity(otu_table(MGE_PHY_counts_HWW), index = "invsimpson", MARGIN = 2)))
#
# all(rownames(div) == colnames(MGE_PHY_counts_HWW@otu_table))
# diversity_observed <- apply(MGE_PHY_counts_HWW@otu_table > 0, 2, sum)
# div$observed <- diversity_observed
#
# div$"hospital" <- cbind(MGE_PHY_counts_HWW@sam_data$hospital)
#
# colnames(div) <- c("shannon", "invsimpson", "observed", "hospital")
#
# # Plot
# p <- ggplot(div, aes(x=hospital, y=shannon, fill = hospital)) +
#   geom_boxplot()
# p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
#   scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
#   theme_classic() + theme(text = element_text(family = "Palatino"),
#     axis.title.y = element_text(size = 35),
#     axis.title.x = element_blank(),
#     axis.text.y = element_text(size = 20),
#     axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
#     legend.position = "none",
#     plot.title = element_text(face = "bold"),
#     plot.margin = margin(0.5, 0.5, 0.5, 0.5, "cm"))
#
# layout <- "
# ABC
# "
#
# p1 <-p1 + labs(title = "Diversity Metrics for MGEs Across Hospitals", subtitle = "Shannon Diversity Index by Hospital") +
#   annotate("text", x = 3, y = -0.3, label = "ABC", size = 6)
#
# # Add ID as labels
# p1 <- p1 + geom_text(aes(label = rownames(div)), hjust = -0.1, vjust = 0.5, size = 4)
# # Save plot
# ggsave(filename = "plot7.tiff",
#        width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
shannon_div <- data.frame("shannon" = diversity(otu_table(MGE_PHY_counts_HWW), index = "shannon", MARGIN = 2))
all(rownames(shannon_div) == colnames(MGE_PHY_counts_HWW@otu_table))
diversity_observed <- apply(MGE_PHY_counts_HWW@otu_table > 0, 2, sum)
shannon_div$observed <- diversity_observed
shannon_div$hospital <- MGE_PHY_counts_HWW@sam_data$hospital
colnames(shannon_div) <- c("shannon", "observed", "hospital")
# Plot
p <- ggplot(shannon_div, aes(x=hospital, y=shannon, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for MGEs Across Hospitals",
subtitle = "Shannon Diversity Index by Hospital") +
scale_y_continuous(limits = c(3.5,max(shannon_div$shannon)), breaks = seq(3.5,max(shannon_div$shannon), by = 0.5))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(shannon_div), shannon_div$shannon)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_shannon.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
simpson_div <- data.frame("simpson" = diversity(otu_table(MGE_PHY_counts_HWW), index = "simpson", MARGIN = 2))
all(rownames(simpson_div) == colnames(MGE_PHY_counts_HWW@otu_table))
diversity_observed <- apply(MGE_PHY_counts_HWW@otu_table > 0, 2, sum)
simpson_div$observed <- diversity_observed
simpson_div$hospital <- MGE_PHY_counts_HWW@sam_data$hospital
colnames(simpson_div) <- c("simpson", "observed", "hospital")
# Plot
p <- ggplot(simpson_div, aes(x=hospital, y=simpson, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for MGEs Across Hospitals",
subtitle = "Simpson Diversity Index by Hospital") +
scale_y_continuous(limits = c(0.92,max(simpson_div$simpson)), breaks = seq(0.92,max(simpson_div$simpson), by = 0.02))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(simpson_div), simpson_div$simpson)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_simpson.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
invsimp_div <- data.frame("invsimpson" = diversity(otu_table(MGE_PHY_counts_HWW), index = "inv", MARGIN = 2))
all(rownames(invsimp_div) == colnames(MGE_PHY_counts_HWW@otu_table))
diversity_observed <- apply(MGE_PHY_counts_HWW@otu_table > 0, 2, sum)
invsimp_div$observed <- diversity_observed
invsimp_div$hospital <- MGE_PHY_counts_HWW@sam_data$hospital
colnames(invsimp_div) <- c("invsimpson", "observed", "hospital")
# Plot
p <- ggplot(invsimp_div, aes(x=hospital, y=invsimpson, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for MGEs Across Hospitals",
subtitle = "Inv Simpson Diversity Index by Hospital") +
scale_y_continuous(limits = c(15,max(invsimp_div$invsimpson)), breaks = seq(15,max(invsimp_div$invsimpson), by = 10))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(invsimp_div), invsimp_div$invsimpson)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot5_invsimpson.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
rich <- data.frame("richness" = specnumber(otu_table(MGE_PHY_counts_HWW), MARGIN=2))
all(rownames(rich) == colnames(MGE_PHY_counts_HWW@otu_table))
rich$hospital <- MGE_PHY_counts_HWW@sam_data$hospital
colnames(rich) <- c("richness", "hospital")
# Plot
p <- ggplot(rich, aes(x=hospital, y=richness, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Richness for MGEs Across Hospitals",
subtitle = "Richness by Hospital") +
scale_y_continuous(limits = c(400,max(rich$richness)), breaks = seq(400,max(rich$richness), by = 50))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(rich), rich$richness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_richness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
even <- data.frame("evenness" = shannon_div$shannon / log(rich$richness))
rownames(even) <- colnames(MGE_PHY_counts_HWW@otu_table)
all(rownames(even) == colnames(MGE_PHY_counts_HWW@otu_table))
even$hospital <- MGE_PHY_counts_HWW@sam_data$hospital
colnames(even) <- c("evenness", "hospital")
# Plot
p <- ggplot(even, aes(x=hospital, y=evenness, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Evenness for MGEs Across Hospitals",
subtitle = "Pielou's Evenness by Hospital") +
scale_y_continuous(limits = c(0.65,max(even$evenness)), breaks = seq(0.65,max(even$evenness), by = 0.05))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(even), even$evenness)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_evenness.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
# # Test the significance
# kruskal.test(observed ~ hospital, data = div)
# # There are sig. differences
#
# # Test multiple pairwise
# stat.test <- pairwise.wilcox.test(div$observed, div$hospital,
#                  p.adjust.method = "BH")
# stat.test
# Gather data
df<-data.frame(RA=sample_sums(resfinder_PHY_rel_HWW),
hospital=as.factor(sample_data(resfinder_PHY_rel_HWW)$hospital))
M <-lm(RA~hospital, data=df)
summary(M)
shapiro.test(df$RA)
# Data is not normally distributed.
plot(M)
# Heterosedasticity?
par(mfrow=c(2,2))
#plot(M)
lmtest::bptest(M)  # Breusch-Pagan test
car::ncvTest(M)  # Breusch-Pagan test
# There is no heteroscedasticity.
# Test
kruskal.test(RA ~ hospital, data = df)
# Test multiple pairwise
stat.test <- pairwise.wilcox.test(df$RA, df$hospital,
p.adjust.method = "BH")
stat.test
pvalues <- tibble::tribble(
~group1, ~group2,   ~p.adj,
"SLMC",     "CGH", "***",
"SLMC",     "UST", "**",
"CGH",     "UST", "**"
)
pvalues
# +
#   stat_pvalue_manual(pvalues, hide.ns = TRUE, size = 8, y.position = 2.5, step.increase = 0.025, label = "p.adj")
# Save plot
p <- ggboxplot(df, x = "hospital", y = "RA", color = "hospital", palette = c("#1C4731", "#910C28", "#1E88E5"), width = 0.3)  +
theme_bw() +
theme(axis.text.x = element_text(size = 16, face = "bold"),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 16),
axis.title.y = element_text(size = 20),
legend.position = "none",
plot.subtitle = element_text(size = 24, hjust = 0.5),
plot.tag = element_text(size = 24, family = "Palatino", face = "bold"),
text = element_text(family = "Palatino"),
aspect.ratio = 1) +
labs(y = "ARGs/16S rRNA", x = "") +
guides(color = "none", alpha = "none") +
geom_jitter(data = df, aes(x = hospital, y = RA, color = hospital), size = 3, alpha = 0.7, width = 0.1) +
geom_text(data = df, aes(x = hospital, y = RA, label = rownames(shannon_div)), size = 3, vjust = -0.5)  +
labs(title = "Comparison of ARGs/16S rRNA Levels Across Hospitals using Wilcoxx")  # Add title
ggsave(filename = "wilcox.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
cols <- get_palette(c("#332288", "#117733", "#52BFAD", "#88CCEE", "#DDCC77", "#FDA4B3",
"#F22D3D", "#882255", "#5F5E98", "#E4C960", "#FD8FD9"), 41)
metaphlan_PHY_rel_genus <- subset_taxa(metaphlan_PHY_rel_genus, Genus != "Coprobacillaceae Family")
metaphlan_PHY_rel_genus <- subset_taxa(metaphlan_PHY_rel_genus, Genus != "Catenibacterium")
metaphlan_PHY_rel_genus <- subset_taxa(metaphlan_PHY_rel_genus, Genus != "NA")
metaphlan_PHY_rel_genus%>%
tax_fix(
min_length = 4,
unknowns = c("NA"),
sep = " ", anon_unique = TRUE,
suffix_rank = "classified"
)
# p <- metaphlan_PHY_rel_genus %>%
#   comp_barplot("Genus", facet_by = "hospital", n_taxa = 40) +
#   coord_flip()
p <- metaphlan_PHY_rel_genus %>%
comp_barplot(tax_level = "Genus", n_taxa = 40,
tax_transform_for_plot = "identity", facet_by  = "hospital", )+
coord_flip()  +
labs(x = NULL, y = NULL) + theme_light() + ggtitle("Top 40 taxa (metaphlan)") +
theme(text = element_text(family = "Palatino"),
plot.title = element_text(size = 30, face = "bold"),
axis.text.y = element_text(size = 10),
axis.text.x = element_text(size = 20),
strip.text.y = element_text(size = 20, color = "black", face = "bold", angle = 0, hjust = 0),
strip.background = element_rect(fill = "white", color = "white"),
panel.spacing.y = unit(1, "lines"),
legend.text = element_text(size = 18, face = "italic"),
legend.title = element_blank(),
legend.position = "bottom", legend.direction = "horizontal",
legend.spacing = unit(0.25, 'cm'),
legend.key.size = unit(0.85, "cm")) + guides(fill = guide_legend(byrow = TRUE))
print (p)
# Save plot
ggsave(filename = "plot12old.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
# metaphlan_PHY_rel_fam <- subset_taxa(metaphlan_PHY_rel_fam, Family != "Coprobacillaceae")
metaphlan_PHY_rel_genus <- subset_taxa(metaphlan_PHY_rel_genus, Genus != "Catenibacterium")
metaphlan_PHY_rel_genus <- subset_taxa(metaphlan_PHY_rel_genus, Genus != "NA")
metaphlan_PHY_rel_genus%>%
tax_fix(
min_length = 4,
unknowns = c("NA"),
sep = " ", anon_unique = TRUE,
suffix_rank = "classified"
)
p <- metaphlan_PHY_rel_genus %>%
comp_barplot("Genus", facet_by = "hospital", n_taxa = 40) +
coord_flip()
# p <- metaphlan_PHY_rel_fam %>%
#   comp_barplot(tax_level = "Family", n_taxa = 40,
#               tax_transform_for_plot = "identity", facet_by  = "hospital", )+
#   coord_flip()  +
#   labs(x = NULL, y = NULL) + theme_light() + ggtitle("Top 40 taxa (metaphlan)") +
#   theme(text = element_text(family = "Palatino"),
#         plot.title = element_text(size = 30, face = "bold"),
#         axis.text.y = element_text(size = 10),
#         axis.text.x = element_text(size = 20),
#         strip.text.y = element_text(size = 20, color = "black", face = "bold", angle = 0, hjust = 0),
#         strip.background = element_rect(fill = "white", color = "white"),
#         panel.spacing.y = unit(1, "lines"),
#         legend.text = element_text(size = 18, face = "italic"),
#         legend.title = element_blank(),
#         legend.position = "bottom", legend.direction = "horizontal",
#         legend.spacing = unit(0.25, 'cm'),
#         legend.key.size = unit(0.85, "cm")) + guides(fill = guide_legend(byrow = TRUE))
print (p)
# Save plot
ggsave(filename = "plot12oldfam.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
p<-plot_bar(resfinder_PHY_rel_HWW, fill = "Class", x = "hospital")
ggsave(filename = "bar_Resfinder.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
otu_table_data <- otu_table(resfinder_PHY_rel_HWW)
print(head(otu_table_data))
invsimp_div <- data.frame("invsimpson" = diversity(otu_table(MGE_PHY_counts_HWW), index = "inv", MARGIN = 2))
all(rownames(invsimp_div) == colnames(MGE_PHY_counts_HWW@otu_table))
diversity_observed <- apply(MGE_PHY_counts_HWW@otu_table > 0, 2, sum)
invsimp_div$observed <- diversity_observed
invsimp_div$hospital <- MGE_PHY_counts_HWW@sam_data$hospital
colnames(invsimp_div) <- c("invsimpson", "observed", "hospital")
# Plot
p <- ggplot(invsimp_div, aes(x=hospital, y=invsimpson, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for MGEs Across Hospitals",
subtitle = "Inv Simpson Diversity Index by Hospital") +
scale_y_continuous(limits = c(15,max(invsimp_div$invsimpson)), breaks = seq(15,max(invsimp_div$invsimpson), by = 10))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(invsimp_div), invsimp_div$invsimpson)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot7_invsimpson.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
invsimp_div <- data.frame("invsimpson" = diversity(otu_table(resfinder_PHY_counts_HWW), index = "inv", MARGIN = 2))
all(rownames(invsimp_div) == colnames(resfinder_PHY_counts_HWW@otu_table))
diversity_observed <- apply(resfinder_PHY_counts_HWW@otu_table > 0, 2, sum)
invsimp_div$observed <- diversity_observed
invsimp_div$hospital <- resfinder_PHY_counts_HWW@sam_data$hospital
colnames(invsimp_div) <- c("invsimpson", "observed", "hospital")
# Plot
p <- ggplot(invsimp_div, aes(x=hospital, y=invsimpson, fill = hospital)) +
geom_boxplot()
# Add ID as label to the plot
p1 <- p + geom_dotplot(binaxis='y', stackdir='center', dotsize = 0.4) +
scale_fill_manual(values=c("#64B98F", "#CD3857", "#61A6E3")) +
theme_classic() + theme(text = element_text(family = "Palatino"),
axis.title.y = element_text(size = 35),
axis.title.x = element_blank(),
axis.text.y = element_text(size = 20),
axis.text.x = element_text(size = 16, angle = 30, hjust = 1, face = "bold"),
legend.position = "none",
plot.title = element_text(face = "bold"),
plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))
# Adjust the scale to be more detailed
p1 <- p1 + labs(title = "Diversity Metrics for ARGs Across Hospitals",
subtitle = "Inv Simpson Diversity Index by Hospital") +
scale_y_continuous(limits = c(15,max(invsimp_div$invsimpson)), breaks = seq(15,max(invsimp_div$invsimpson), by = 10))
# Add ID as labels
p1 <- p1 + geom_text(aes(label = paste(rownames(invsimp_div), invsimp_div$invsimpson)), hjust = -0.1, vjust = 0.5, size = 4)
p1  # Display the plot
# Save plot
ggsave(filename = "plot5_invsimpson.tiff",
width = 16, height = 13, dpi = 300, units = "in", device='tiff', scale = 1)
